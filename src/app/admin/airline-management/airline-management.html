<div class="admin-container">
  <!-- Sidebar Component -->
  <app-admin-sidebar></app-admin-sidebar>

  <!-- Main Content -->
  <main class="content">
    <app-admin-header></app-admin-header>

    <div class="header">
      <h1>Quản lý hãng bay</h1>
      <p class="subtitle">Chào Tường Vy, mừng bạn đến với trang quản lý hãng bay!</p>
    </div>

    <div class="main-content-panel">

      <div class="tab-header-row">
        <div class="tabs">
          <button [class.active]="activeTab === 'list'" (click)="switchTab('list')">
            Quản lý hãng bay
          </button>
          <button [class.active]="activeTab === 'form'" (click)="switchTab('form')">
            Cập nhật thông tin
          </button>
        </div>

        <!-- Quản lý hãng bay -->
        <div class="list-toolbar" *ngIf="activeTab === 'list'">
          <div class="search-wrap">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#999">
              <circle cx="11" cy="11" r="8" stroke-width="2"></circle>
              <line x1="21" y1="21" x2="16.65" y2="16.65" stroke-width="2"></line>
            </svg>
            <input type="text" placeholder="Tìm theo mã, tên hãng bay..." [ngModel]="searchTerm"
              (ngModelChange)="onSearchChange($event)" />
          </div>

          <div class="filter-wrap">
            <select [(ngModel)]="selectedAirline" (change)="onAirlineChange($event)">
              <option value="all">Tất cả trạng thái</option>
              <option value="Đang hợp tác">Đang hợp tác</option>
              <option value="Ngừng hợp tác">Ngừng hợp tác</option>
            </select>
          </div>

          <button class="btn btn-add-new" (click)="navigateToAddForm()">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
              <line x1="12" y1="5" x2="12" y2="19"></line>
              <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
            <span>Thêm</span>
          </button>
        </div>
      </div>

      <!-- Bảng Quản lý hãng bay -->
      <div *ngIf="activeTab === 'list'" class="list-container">
        <div class="table-wrapper">
          <table>
            <thead>
              <tr>
                <th>Mã hãng bay</th>
                <th>Tên hãng bay</th>
                <th>Quốc gia</th>
                <th>Hotline</th>
                <th>Tỷ lệ hoa hồng (%)</th>
                <th>Trạng thái</th>
                <th>Hành động</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngIf="paginatedFlights.length === 0">
                <td colspan="7" class="no-data">Không tìm thấy thông tin hãng bay nào.</td>
              </tr>
              <tr *ngFor="let airline of paginatedFlights">
                <td>{{ airline.airlineCode }}</td>
                <td>{{ airline.airlineName }}</td>
                <td>{{ airline.country }}</td>
                <td>{{ airline.hotline }}</td>
                <td>{{ airline.commissionRate }}</td>
                <td>{{ airline.status }}</td>
                <td class="actions">
                  <button title="Xem" class="action-btn view" (click)="viewAirline(airline)">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                      <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z" stroke-width="1.5"></path>
                      <circle cx="12" cy="12" r="3" stroke-width="1.5"></circle>
                    </svg>
                  </button>
                  <button title="Sửa" class="action-btn edit" (click)="editAirline(airline)">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                      <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7" stroke-width="1.5"></path>
                      <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z" stroke-width="1.5"></path>
                    </svg>
                  </button>
                  <button title="Xóa" class="action-btn delete" (click)="promptDelete(airline.airlineCode)">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                      <polyline points="3 6 5 6 21 6" stroke-width="1.5"></polyline>
                      <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"
                        stroke-width="1.5"></path>
                    </svg>
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        <div class="pagination-controls" *ngIf="totalPages > 1">
          <button class="btn btn-page" (click)="prevPage()" [disabled]="currentPage === 1">
            &lt;&lt;
          </button>

          <span class="page-info">
            Trang {{ currentPage }} / {{ totalPages }}
          </span>

          <button class="btn btn-page" (click)="nextPage()" [disabled]="currentPage === totalPages">
            &gt;&gt;
          </button>
        </div>
      </div>

      <!-- Form Cập nhật hãng bay -->
      <div *ngIf="activeTab === 'form'" class="form-container">
        <div class="flight-form">
          <!-- Cột 1 -->
          <div class="form-column">
            <div>
              <label>Mã hãng bay</label>
              <input [(ngModel)]="emptyFormAirline.airlineCode" type="text" placeholder="Ví dụ: VN" />
            </div>
            <div>
              <label>Quốc gia</label>
              <input [(ngModel)]="emptyFormAirline.country" type="text" placeholder="Ví dụ: Vietnam" />
            </div>
            <div>
              <label>Tên hãng bay</label>
              <input [(ngModel)]="emptyFormAirline.airlineName" type="text" placeholder="Ví dụ: Vietnam Airlines" />
            </div>
            <div>
              <label>Hotline</label>
              <input [(ngModel)]="emptyFormAirline.hotline" type="text" placeholder="Ví dụ: 1900 1100" />
            </div>
          </div>

          <!-- Cột 2 -->
          <div class="form-column">
            <div>
              <label>Tỷ lệ hoa hồng (%)</label>
              <input [(ngModel)]="emptyFormAirline.commissionRate" type="number" placeholder="Ví dụ: 5" />
            </div>
            <div>
              <label>Trạng thái</label>
              <select [(ngModel)]="emptyFormAirline.status">
                <option value="Đang hợp tác">Đang hợp tác</option>
                <option value="Ngừng hợp tác">Ngừng hợp tác</option>
              </select>
            </div>
            <div>
              <label>Ghi chú</label>
              <input [(ngModel)]="emptyFormAirline.notes" type="text" />
            </div>
          </div>
        </div>

        <div class="form-buttons">
          <button class="btn form-btn-cancel" (click)="cancelForm()">Hủy</button>
          <button class="btn form-btn-save" (click)="addAirline()" [disabled]="isFormInvalid">
            Lưu
          </button>
          <button class="btn form-btn-edit" (click)="updateAirline()"
            [disabled]="emptyFormAirline.id === 0 || isFormInvalid">
            Chỉnh sửa
          </button>
        </div>
      </div>
    </div>

    <div *ngIf="showDeleteConfirm" class="modal-overlay">
      <div class="modal-content">
        <h4>Xác nhận xóa</h4>
        <p>Bạn có chắc chắn muốn xóa hãng bay này không? Hành động này không thể hoàn tác.</p>
        <div class="modal-buttons">
          <button class="btn btn-modal-cancel" (click)="cancelDelete()">Hủy</button>
          <button class="btn btn-modal-delete" (click)="confirmDelete()">Xóa</button>
        </div>
      </div>
    </div>

    <div *ngIf="showViewModal && airlineToView" class="modal-overlay">
      <div class="modal-content modal-view">
        <h4>Chi tiết hãng bay #{{ airlineToView.airlineCode }}</h4>
        <div class="view-details-grid">

          <div class="detail-item"><label>Mã hãng bay</label><span>{{ airlineToView.airlineCode }}</span></div>
          <div class="detail-item"><label>Tên hãng bay</label><span>{{ airlineToView.airlineName }}</span></div>
          <div class="detail-item"><label>Quốc gia</label><span>{{ airlineToView.country }}</span></div>
          <div class="detail-item"><label>Hotline</label><span>{{ airlineToView.hotline }}</span></div>
          <div class="detail-item full-width"><label>Tỷ lệ hoa hồng (%)</label>
            <span>{{ airlineToView.commissionRate }}</span>
          </div>
          <div class="detail-item full-width"><label>Trạng thái</label>
            <span>{{ airlineToView.status }}</span>
          </div>
          <div class="detail-item full-width"><label>Ghi chú</label><span>{{ airlineToView.notes || '(Không có)'
              }}</span>
          </div>
        </div>
        <div class="modal-buttons">
          <button class="btn btn-modal-close" (click)="closeViewModal()">Đóng</button>
        </div>
      </div>
    </div>
  </main>
</div>